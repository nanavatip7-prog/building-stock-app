<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Management</title>

<style>
/* ===== BASE ===== */
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 0;
}

header {
  background: #2c3e50;
  color: white;
  padding: 14px;
  text-align: center;
  font-size: 20px;
}

nav {
  display: flex;
  background: #34495e;
}

nav button {
  flex: 1;
  padding: 12px;
  border: none;
  background: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

nav button.active {
  background: #1abc9c;
  color: black;
}

.tab {
  display: none;
  padding: 15px;
  background: white;
}

.tab.active {
  display: block;
}

/* ===== TABLE ===== */
.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  min-width: 500px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

th {
  background: #eee;
}

/* ===== FORM ===== */
select, input, button {
  padding: 10px;
  margin: 6px 0;
  width: 100%;
  font-size: 16px;
}

button.action {
  background: #1abc9c;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

/* ===== MOBILE ===== */
@media (max-width: 768px) {
  header {
    font-size: 18px;
  }

  nav {
    flex-wrap: wrap;
  }

  nav button {
    flex: 50%;
    font-size: 15px;
  }

  h3 {
    font-size: 18px;
  }

  table {
    font-size: 14px;
  }
}
</style>
</head>

<body>

<header>üè™ Stock Management System</header>

<nav>
  <button class="active" onclick="showTab('stock')">Stock</button>
  <button onclick="showTab('purchase')">‡§ñ‡§∞‡•á‡§¶‡•Ä</button>
  <button onclick="showTab('sale')">‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</button>
  <button onclick="showTab('report')">üìä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</button>
</nav>

<!-- STOCK -->
<div id="stock" class="tab active">
  <h3>üì¶ Stock</h3>

  <select id="stockFilter" onchange="loadStock()"></select>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü</th>
          <th>Unit</th>
          <th>Stock</th>
        </tr>
      </thead>
      <tbody id="stockBody"></tbody>
    </table>
  </div>
</div>

<!-- PURCHASE -->
<div id="purchase" class="tab">
  <h3>üß± ‡§ñ‡§∞‡•á‡§¶‡•Ä</h3>

  <select id="pProduct"></select>
  <input id="pQty" type="number" placeholder="Quantity">
  <input id="dealer" placeholder="Dealer">
  <button class="action" onclick="purchase()">Save</button>
</div>

<!-- SALE -->
<div id="sale" class="tab">
  <h3>üöö ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</h3>

  <select id="sProduct"></select>
  <input id="sQty" type="number" placeholder="Quantity">
  <input id="customer" placeholder="Customer">
  <button class="action" onclick="sale()">Save</button>
</div>

<!-- REPORT -->
<div id="report" class="tab">
  <h3>üìä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</h3>

  <select id="rType">
    <option value="purchase">‡§ñ‡§∞‡•á‡§¶‡•Ä</option>
    <option value="sale">‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</option>
  </select>

  <select id="rProduct"></select>
  <input type="month" id="rMonth">

  <button class="action" onclick="loadReport()">Load</button>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü</th>
          <th>Qty</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="reportBody"></tbody>
    </table>
  </div>
</div>

<script>
function showTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

async function loadProducts(){
  const res = await fetch("/api/products");
  const data = await res.json();

  ["pProduct","sProduct","stockFilter","rProduct"].forEach(id=>{
    const el = document.getElementById(id);
    el.innerHTML = `<option value="">‡§∏‡§∞‡•ç‡§µ</option>`;
    data.forEach(p=>{
      el.innerHTML += `<option value="${p.id}">${p.name}</option>`;
    });
  });
}

async function loadStock(){
  const pid = stockFilter.value;
  const url = pid ? `/api/stock?product_id=${pid}` : "/api/stock";
  const res = await fetch(url);
  const data = await res.json();

  stockBody.innerHTML="";
  data.forEach(p=>{
    stockBody.innerHTML += `
      <tr>
        <td>${p.product}</td>
        <td>${p.unit}</td>
        <td>${p.stock}</td>
      </tr>`;
  });
}

async function purchase(){
  await fetch("/api/purchase",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      product_id:pProduct.value,
      quantity:pQty.value,
      dealer_name:dealer.value
    })
  });
  loadStock();
}

async function sale(){
  await fetch("/api/sale",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      product_id:sProduct.value,
      quantity:sQty.value,
      customer_name:customer.value
    })
  });
  loadStock();
}

async function loadReport(){
  const url = `/api/report/${rType.value}?month=${rMonth.value}&product_id=${rProduct.value}`;
  const res = await fetch(url);
  const data = await res.json();

  reportBody.innerHTML="";
  data.forEach(r=>{
    reportBody.innerHTML += `
      <tr>
        <td>${r.product}</td>
        <td>${r.quantity}</td>
        <td>${new Date(r.created_at).toLocaleString()}</td>
      </tr>`;
  });
}

loadProducts();
loadStock();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <title>Shop Stock Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 12px;
      text-align: center;
      font-size: 22px;
    }
    nav {
      display: flex;
      background: #34495e;
    }
    nav button {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    nav button.active {
      background: #1abc9c;
      color: black;
    }
    .tab {
      display: none;
      padding: 20px;
    }
    .tab.active {
      display: block;
      background: white;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #eee;
    }
    input, select, button {
      padding: 6px;
      margin: 5px;
    }
    button.action {
      background: #1abc9c;
      border: none;
      cursor: pointer;
    }
  </style>
</head>

<body>

<header>üè™ Stock Management System</header>

<nav>
  <button class="active" onclick="showTab('stock')">Stock</button>
  <button onclick="showTab('purchase')">‡§ñ‡§∞‡•á‡§¶‡•Ä</button>
  <button onclick="showTab('sale')">‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</button>
  <button onclick="showTab('report')">üìä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</button>
</nav>

<!-- STOCK TAB -->
<div id="stock" class="tab active">
  <h2>üì¶ ‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§∏‡§æ‡§†‡§æ</h2>
  <table>
    <thead>
      <tr>
        <th>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü</th>
        <th>Unit</th>
        <th>Stock</th>
      </tr>
    </thead>
    <tbody id="stockTable"></tbody>
  </table>
</div>

<!-- PURCHASE TAB -->
<div id="purchase" class="tab">
  <h2>üß± ‡§ñ‡§∞‡•á‡§¶‡•Ä</h2>
  <select id="purchaseProduct"></select>
  <input type="number" id="purchaseQty" placeholder="Quantity" />
  <input type="text" id="dealerName" placeholder="From which dealer?" />
  <button class="action" onclick="addPurchase()">Save</button>
</div>

<!-- SALE TAB -->
<div id="sale" class="tab">
  <h2>üöö ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</h2>
  <select id="saleProduct"></select>
  <input type="number" id="saleQty" placeholder="Quantity" />
  <input type="text" id="customerName" placeholder="To whom?" />
  <button class="action" onclick="addSale()">Save</button>
</div>

<!-- REPORT TAB -->
<div id="report" class="tab">
  <h2>üìä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</h2>

  <select id="reportPeriod">
    <option value="daily">Daily</option>
    <option value="monthly">Monthly</option>
  </select>

  <input type="month" id="reportMonth" style="display:none;" />

  <select id="reportType">
    <option value="both">‡§∏‡§∞‡•ç‡§µ</option>
    <option value="purchase">‡§ñ‡§∞‡•á‡§¶‡•Ä</option>
    <option value="sale">‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</option>
  </select>

  <select id="reportProduct">
    <option value="">‡§∏‡§∞‡•ç‡§µ ‡§¨‡•ç‡§∞‡§Å‡§°</option>
  </select>

  <button class="action" onclick="loadReport()">Load</button>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Dealer / Customer</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody id="reportTable"></tbody>
  </table>
</div>

<script>
const API = "http://localhost:4000";

function showTab(id) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

async function loadProducts() {
  const res = await fetch(API + "/products");
  const data = await res.json();

  const stock = document.getElementById("stockTable");
  const pSel = document.getElementById("purchaseProduct");
  const sSel = document.getElementById("saleProduct");
  const rSel = document.getElementById("reportProduct");

  stock.innerHTML = "";
  pSel.innerHTML = "";
  sSel.innerHTML = "";
  rSel.innerHTML = '<option value="">‡§∏‡§∞‡•ç‡§µ</option>';

  data.forEach(p => {
    stock.innerHTML += `<tr><td>${p.display_name}</td><td>${p.unit}</td><td>${p.stock}</td></tr>`;
    pSel.innerHTML += `<option value="${p.id}">${p.display_name}</option>`;
    sSel.innerHTML += `<option value="${p.id}">${p.display_name}</option>`;
    rSel.innerHTML += `<option value="${p.id}">${p.display_name}</option>`;
  });
}

async function addPurchase() {
  await fetch(API + "/purchase", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      product_id: purchaseProduct.value,
      quantity: purchaseQty.value,
      dealer_name: dealerName.value
    })
  });
  alert("‡§ñ‡§∞‡•á‡§¶‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§ù‡§æ‡§≤‡•Ä");
  loadProducts();
}

async function addSale() {
  await fetch(API + "/sale", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      product_id: saleProduct.value,
      quantity: saleQty.value,
      customer_name: customerName.value
    })
  });
  alert("‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§ù‡§æ‡§≤‡•Ä");
  loadProducts();
}

document.getElementById("reportPeriod").onchange = e => {
  reportMonth.style.display = e.target.value === "monthly" ? "inline" : "none";
};

async function loadReport() {
  let url = API + "/report/" + reportPeriod.value +
    "?type=" + reportType.value;

  if (reportProduct.value) url += "&product_id=" + reportProduct.value;
  if (reportPeriod.value === "monthly") url += "&month=" + reportMonth.value;

  const res = await fetch(url);
  const data = await res.json();
  const table = document.getElementById("reportTable");
  table.innerHTML = "";

  (data.purchases || []).forEach(r => {
    table.innerHTML += `<tr>
      <td>${new Date(r.created_at).toLocaleString()}</td>
      <td>${r.display_name}</td>
      <td>${r.quantity}</td>
      <td>${r.dealer_name}</td>
      <td>‡§ñ‡§∞‡•á‡§¶‡•Ä</td>
    </tr>`;
  });

  (data.sales || []).forEach(r => {
    table.innerHTML += `<tr>
      <td>${new Date(r.created_at).toLocaleString()}</td>
      <td>${r.display_name}</td>
      <td>${r.quantity}</td>
      <td>${r.customer_name}</td>
      <td>‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä</td>
    </tr>`;
  });
}

loadProducts();
</script>

</body>
</html>
